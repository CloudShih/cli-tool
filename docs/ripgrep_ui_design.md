# Ripgrep UI/UX 設計規範文檔
**版本**: 1.0  
**日期**: 2025-01-06  
**專案**: CLI Tool Integration - ripgrep 模組  

## 🎨 設計原則

### 核心設計理念
1. **漸進式揭露** - 簡單開始，按需展示複雜功能
2. **視覺一致性** - 與現有工具保持相同的設計語言
3. **效能優化** - 針對大量搜尋結果的使用者體驗優化
4. **直觀操作** - 符合使用者對搜尋工具的預期行為

### 設計約束
- 遵循現有應用的 MVC 架構模式
- 使用現有的 ModernButton、ModernLineEdit 等 UI 元件
- 支援深色/淺色主題切換
- 保持與其他工具相同的動畫和過渡效果

## 📐 整體佈局設計

### 主要區域劃分
```
┌─ Ripgrep 工具介面 ────────────────────────────────────┐
│                                                     │
│ ┌─ 搜尋面板 ─────────────────────────────────────────┐ │
│ │ [搜尋輸入區] [選項控制] [執行按鈕]                    │ │
│ └───────────────────────────────────────────────────┘ │
│                                                     │
│ ┌─ 進階選項面板 (可摺疊) ──────────────────────────────┐ │
│ │ [詳細搜尋參數] [檔案過濾] [上下文控制]               │ │
│ └───────────────────────────────────────────────────┘ │
│                                                     │
│ ┌─ 結果顯示面板 ──────────────────────────────────────┐ │
│ │ [工具列] [樹狀結果] [狀態資訊]                       │ │
│ │                                                   │ │
│ │                                                   │ │
│ │                                                   │ │
│ └───────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

## 🔍 搜尋面板設計

### 基本搜尋介面
```python
# 主要搜尋控制項
┌─ 基本搜尋 ─────────────────────────────────────────┐
│ 搜尋模式: [________________________] [🔍 搜尋]      │
│          預設提示: "輸入搜尋文字或正則表達式..."       │
│                                                   │
│ 搜尋路徑: [________________________] [📁 瀏覽]      │
│          預設提示: "選擇搜尋目錄 (空白=當前目錄)"      │
│                                                   │
│ [⚙️ 進階選項] [🚫 清除] [⏹️ 停止] [💾 儲存設定]       │
└───────────────────────────────────────────────────┘
```

### 快速選項切換
```python
# 常用選項快速切換
┌─ 快速選項 ─────────────────────────────────────────┐
│ ☐ 大小寫敏感  ☐ 全字匹配  ☐ 正則表達式  ☐ 多行搜尋  │
└───────────────────────────────────────────────────┘
```

## ⚙️ 進階選項面板設計

### 可摺疊面板實現
```python
class AdvancedOptionsPanel(QWidget):
    """進階選項面板 - 預設摺疊"""
    
    def __init__(self):
        super().__init__()
        self.is_expanded = False
        self.setup_ui()
    
    def toggle_panel(self):
        """切換面板顯示/隱藏狀態"""
        # 動畫效果切換
        pass
```

### 進階選項內容
```
┌─ 進階選項 ─────────────────────────────────────────┐
│ 檔案過濾:                                          │
│   包含類型: [*.py,*.js,*.md] 排除模式: [*.log,*.tmp] │
│                                                   │
│ 搜尋控制:                                          │
│   最大深度: [無限制 ▼]  上下文行數: [3] 行           │
│   最大結果: [1000]     執行緒數: [自動 ▼]            │
│                                                   │
│ 特殊選項:                                          │
│   ☐ 搜尋隱藏檔案  ☐ 跟隨符號連結  ☐ 搜尋二進位檔案  │
│   ☐ 使用 Git 忽略規則  ☐ 顯示檔案路徑統計          │
└───────────────────────────────────────────────────┘
```

## 📊 結果顯示設計

### 階層式結果樹狀結構
```python
# 結果顯示模式
Results (1,247 matches in 23 files) [⏱️ 2.3s]

📊 統計資訊
├─ 總計: 1,247 個匹配
├─ 檔案: 23 個
└─ 搜尋時間: 2.34 秒

🗂️ 按檔案分組
├─ 📄 src/main.py (45 matches)
│   ├─ 📍 Line 23:12 │ import logging  # 匹配 'log'
│   ├─ 📍 Line 45:8  │ logger.info("Starting...")
│   ├─ 📍 Line 67:15 │ log_level = "DEBUG"
│   └─ [▼ 顯示其餘 42 個匹配]
│
├─ 📄 tests/test_main.py (12 matches)
│   ├─ 📍 Line 15:8  │ # Test logging functionality
│   └─ [▼ 顯示其餘 11 個匹配]
│
└─ [▼ 顯示其餘 21 個檔案]
```

### 匹配項詳細顯示
```python
# 單一匹配項的上下文顯示
┌─ 匹配詳情 ─────────────────────────────────────────┐
│ 檔案: src/main.py │ 行: 45 │ 欄: 8                │
│                                                   │
│   43 │     def setup_logging():                    │
│   44 │         """Setup application logging"""     │
│ > 45 │         logger = logging.getLogger(__name__) │
│   46 │         handler = logging.StreamHandler()   │
│   47 │         logger.addHandler(handler)          │
│                                                   │
│ [📋 複製行] [📝 複製含上下文] [📂 開啟檔案] [🎯 跳至行]  │
└───────────────────────────────────────────────────┘
```

## 🛠️ 工具列設計

### 結果操作工具列
```python
┌─ 結果工具列 ───────────────────────────────────────┐
│ 導航: [⬅️ 上一個] [➡️ 下一個] 匹配 5/1,247         │
│                                                   │
│ 顯示: [📤 全部展開] [📥 全部摺疊] [🎯 跳至匹配]       │
│                                                   │
│ 操作: [📋 複製結果] [💾 匯出] [🔄 重新搜尋]          │
└───────────────────────────────────────────────────┘
```

### 狀態列資訊
```python
┌─ 狀態列 ───────────────────────────────────────────┐
│ 🔍 搜尋中... (234 個檔案已掃描, 45 個匹配)           │
│ [⏹️ 停止搜尋]                    記憶體使用: 23MB  │
└───────────────────────────────────────────────────┘
```

## 🎭 互動行為設計

### 鍵盤快捷鍵
| 快捷鍵 | 功能 | 描述 |
|-------|------|------|
| `Ctrl+F` | 開始搜尋 | 焦點移至搜尋輸入框 |
| `Enter` | 執行搜尋 | 在搜尋輸入框中按下執行搜尋 |
| `Escape` | 取消/清除 | 停止搜尋或清除輸入 |
| `F3` | 下一個匹配 | 跳至下一個搜尋匹配項 |
| `Shift+F3` | 上一個匹配 | 跳至上一個搜尋匹配項 |
| `Ctrl+E` | 切換進階選項 | 顯示/隱藏進階選項面板 |
| `Ctrl+G` | 跳至行號 | 開啟跳至特定行號對話框 |

### 滑鼠互動
- **單擊檔案名稱**: 摺疊/展開該檔案的匹配項
- **雙擊匹配行**: 開啟檔案並跳至該行
- **右鍵選單**: 提供複製、開啟、匯出等選項
- **滑鼠懸停**: 顯示完整檔案路徑和額外資訊

### 拖放功能
- **檔案拖入**: 可將檔案或資料夾拖入搜尋路徑欄位
- **結果拖出**: 可將搜尋結果拖出到其他應用程式

## 🎨 視覺樣式規範

### 顏色系統
```python
# 主題色彩定義
COLORS = {
    'match_highlight': '#FFD700',      # 匹配文字高亮 - 金黃色
    'line_number': '#666666',          # 行號顏色 - 灰色
    'context_text': '#888888',         # 上下文文字 - 淺灰色
    'file_name': '#4CAF50',            # 檔案名稱 - 綠色
    'match_count': '#2196F3',          # 匹配計數 - 藍色
    'error_text': '#F44336',           # 錯誤訊息 - 紅色
    'success_text': '#4CAF50',         # 成功訊息 - 綠色
    'warning_text': '#FF9800',         # 警告訊息 - 橙色
}
```

### 字型和尺寸
```python
# 字型設定
FONTS = {
    'search_input': ('Segoe UI', 11),      # 搜尋輸入框
    'results_content': ('Consolas', 10),   # 結果內容 (等寬字型)
    'file_names': ('Segoe UI', 10, 'bold'), # 檔案名稱
    'line_numbers': ('Consolas', 9),       # 行號
    'status_text': ('Segoe UI', 9),        # 狀態文字
}

# 尺寸規範
SIZES = {
    'search_panel_height': 120,
    'advanced_panel_height': 150,
    'results_min_height': 300,
    'button_height': 32,
    'input_height': 28,
    'spacing': 8,
}
```

### 圖示系統
```python
# 圖示對應
ICONS = {
    'search': '🔍',
    'folder': '📁', 
    'file': '📄',
    'match': '📍',
    'expand': '▼',
    'collapse': '▶',
    'settings': '⚙️',
    'export': '💾',
    'copy': '📋',
    'clear': '🚫',
    'stop': '⏹️',
    'previous': '⬅️',
    'next': '➡️',
    'jump': '🎯',
}
```

## 📱 響應式設計

### 視窗尺寸適配
```python
# 最小尺寸要求
MIN_WINDOW_SIZE = (800, 600)

# 面板尺寸比例
PANEL_RATIOS = {
    'search_panel': 0.2,      # 20% 高度
    'advanced_panel': 0.15,   # 15% 高度 (可摺疊)
    'results_panel': 0.65,    # 65% 高度
}

# 響應式調整規則
def adjust_layout(window_width, window_height):
    """根據視窗尺寸調整佈局"""
    if window_width < 900:
        # 窄螢幕模式：隱藏部分按鈕文字，使用圖示
        pass
    if window_height < 700:
        # 低螢幕模式：預設摺疊進階選項
        pass
```

## 🚀 效能優化設計

### 大量結果處理
1. **虛擬滾動**: 只渲染可見區域的結果項
2. **延遲載入**: 初始只載入前 100 個匹配項
3. **分頁顯示**: 提供"載入更多"功能按鈕
4. **結果快取**: 快取搜尋結果避免重複處理

### 搜尋回饋設計
```python
# 搜尋狀態顯示
class SearchStatus:
    IDLE = "準備就緒"
    SEARCHING = "搜尋中... ({files_scanned} 個檔案, {matches} 個匹配)"
    COMPLETED = "搜尋完成 ({total_matches} 個匹配, {search_time:.2f}s)"
    CANCELLED = "搜尋已取消"
    ERROR = "搜尋錯誤: {error_message}"
```

## 🎯 可存取性設計

### 鍵盤導航
- 所有功能都可透過鍵盤操作
- Tab 順序合理且直觀
- 提供跳過功能的快捷鍵

### 螢幕閱讀器支援
- 所有互動元素都有適當的 ARIA 標籤
- 狀態變更會通知螢幕閱讀器
- 結果結構層次清晰

### 視覺輔助
- 高對比度色彩選擇
- 色盲友善的顏色組合
- 可調整的字型大小

## 📋 實作檢查清單

### UI 元件實作
- [ ] 基本搜尋輸入介面
- [ ] 進階選項摺疊面板
- [ ] 階層式結果樹狀顯示
- [ ] 匹配項詳細檢視器
- [ ] 搜尋狀態和進度指示器

### 互動功能實作
- [ ] 鍵盤快捷鍵支援
- [ ] 滑鼠右鍵選單
- [ ] 拖放功能
- [ ] 檔案/匹配項導航

### 效能優化實作
- [ ] 虛擬滾動實作
- [ ] 結果延遲載入
- [ ] 搜尋取消機制
- [ ] 記憶體使用監控

### 可存取性實作
- [ ] ARIA 標籤和描述
- [ ] 鍵盤導航順序
- [ ] 高對比度主題支援
- [ ] 螢幕閱讀器相容性測試

---

**下一步**: 進入技術規劃階段，基於此設計規範制定詳細的技術實現方案。