# csvkit ç·¨ç¢¼è™•ç†èˆ‡æª”æ¡ˆä¿å­˜åŠŸèƒ½å¯¦ç¾ç¸½çµ

## ğŸ¯ ä»»å‹™å®Œæˆç‹€æ…‹

âœ… **ç·¨ç¢¼è™•ç†å•é¡Œä¿®å¾©** - å®Œæˆ  
âœ… **æª”æ¡ˆä¿å­˜åŠŸèƒ½æ·»åŠ ** - å®Œæˆ  
âœ… **æª”æ¡ˆè¼¸å‡ºç®¡ç†æ”¹å–„** - å®Œæˆ  
âœ… **åŠŸèƒ½æ¸¬è©¦é©—è­‰** - å®Œæˆ  

## ğŸ”§ å¯¦ç¾çš„æ ¸å¿ƒåŠŸèƒ½

### 1. æ™ºèƒ½ç·¨ç¢¼è™•ç†ç³»çµ±

**å¤šç·¨ç¢¼è‡ªå‹•æª¢æ¸¬èˆ‡å›é€€**ï¼š
- **UTF-8** - ä¸»è¦ç·¨ç¢¼æ ¼å¼ï¼Œæ”¯æ´åœ‹éš›åŒ–å­—ç¬¦
- **CP950** - Windows ç¹é«”ä¸­æ–‡ç’°å¢ƒæ¨™æº–ç·¨ç¢¼
- **BIG5** - å‚³çµ±ç¹é«”ä¸­æ–‡ç·¨ç¢¼
- **GBK** - ç°¡é«”ä¸­æ–‡ç·¨ç¢¼æ”¯æ´
- **Latin-1** - æœ€å¾Œå›é€€é¸é …

**å¯¦ç¾ä½ç½®**ï¼š`tools/csvkit/csvkit_model.py:277-325`

```python
def _execute_command(self, command: List[str]) -> Tuple[str, str, int]:
    # å˜—è©¦å¤šç¨®ç·¨ç¢¼è™•ç†æ–¹å¼
    encodings_to_try = ['utf-8', 'cp950', 'big5', 'gbk', 'latin-1']
    
    for encoding in encodings_to_try:
        try:
            process = subprocess.Popen(
                command,
                stdout=subprocess.PIPE,
                stderr=subprocess.PIPE,
                encoding=encoding,
                errors='replace'  # éŒ¯èª¤å­—ç¬¦æ›¿æ›
            )
            
            stdout, stderr = process.communicate(timeout=30)
            
            if process.returncode == 0 or stdout or stderr:
                return stdout, stderr, process.returncode
                
        except UnicodeDecodeError:
            continue  # å˜—è©¦ä¸‹ä¸€ç¨®ç·¨ç¢¼
    
    # bytes æ¨¡å¼ä½œç‚ºæœ€å¾Œå›é€€
    # ... (å®Œæ•´éŒ¯èª¤è™•ç†é‚è¼¯)
```

**é—œéµç‰¹æ€§**ï¼š
- ğŸ”„ **è‡ªå‹•å›é€€æ©Ÿåˆ¶** - ç·¨ç¢¼å¤±æ•—æ™‚è‡ªå‹•å˜—è©¦ä¸‹ä¸€ç¨®ç·¨ç¢¼
- ğŸ›¡ï¸ **éŒ¯èª¤æ›¿æ›æ¨¡å¼** - `errors='replace'` ç¢ºä¿ä¸æœƒå› ç·¨ç¢¼å•é¡Œå´©æ½°
- â±ï¸ **è¶…æ™‚ä¿è­·** - 30ç§’å‘½ä»¤åŸ·è¡Œè¶…æ™‚é˜²æ­¢æ›èµ·
- ğŸ“ **è©³ç´°æ—¥èªŒ** - è¨˜éŒ„ä½¿ç”¨çš„ç·¨ç¢¼å’ŒåŸ·è¡Œç‹€æ…‹

### 2. æª”æ¡ˆä¿å­˜åŠŸèƒ½ç³»çµ±

**å¤šç·¨ç¢¼æª”æ¡ˆä¿å­˜**ï¼š
å¯¦ç¾ä½ç½®ï¼š`tools/csvkit/csvkit_model.py:352-415`

```python
def save_result_to_file(self, content: str, suggested_filename: str = None, 
                       file_type: str = "csv") -> Tuple[bool, str]:
    # æ™ºèƒ½æª”åç”Ÿæˆ
    if not suggested_filename:
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        suggested_filename = f"csvkit_output_{timestamp}.{file_type}"
    
    # æª”æ¡ˆå°è©±æ¡†æ•´åˆ
    file_path, _ = QFileDialog.getSaveFileName(
        None,
        f"ä¿å­˜ {file_type.upper()} æª”æ¡ˆ",
        suggested_filename,
        f"{file_type.upper()} æª”æ¡ˆ (*.{file_type});;æ‰€æœ‰æª”æ¡ˆ (*)"
    )
    
    # å¤šç·¨ç¢¼ä¿å­˜å˜—è©¦
    encodings_to_try = ['utf-8-sig', 'utf-8', 'cp950', 'big5']
    
    for encoding in encodings_to_try:
        try:
            with open(file_path, 'w', encoding=encoding, newline='') as f:
                f.write(content)
            return True, file_path
        except UnicodeEncodeError:
            continue
    
    # éŒ¯èª¤æ›¿æ›æ¨¡å¼ä½œç‚ºæœ€å¾Œé¸é …
    # ... (å®Œæ•´éŒ¯èª¤è™•ç†)
```

**ä¿å­˜åŠŸèƒ½ç‰¹æ€§**ï¼š
- ğŸ“ **ç”¨æˆ¶å‹å–„æª”æ¡ˆå°è©±æ¡†** - æ”¯æ´æª”æ¡ˆé¡å‹ç¯©é¸å’Œè‡ªå‹•æª”åå»ºè­°
- ğŸ”¤ **æ™ºèƒ½ç·¨ç¢¼é¸æ“‡** - UTF-8-BOM å„ªå…ˆï¼Œé©æ‡‰ä¸åŒç³»çµ±éœ€æ±‚
- ğŸ“… **è‡ªå‹•æª”åç”Ÿæˆ** - æ™‚é–“æˆ³è¨˜ç¢ºä¿æª”åå”¯ä¸€æ€§
- ğŸ¯ **æª”æ¡ˆé¡å‹æª¢æ¸¬** - è‡ªå‹•è­˜åˆ¥ CSVã€JSONã€TXTã€HTML æ ¼å¼
- ğŸ›¡ï¸ **éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶** - ç·¨ç¢¼å¤±æ•—æ™‚ä½¿ç”¨éŒ¯èª¤æ›¿æ›æ¨¡å¼

### 3. GUI æ•´åˆåŠŸèƒ½

**è¦–åœ–å±¤æ•´åˆ**ï¼š
å¯¦ç¾ä½ç½®ï¼š`tools/csvkit/csvkit_view.py:496-751`

```python
class CsvkitView(QWidget):
    # ä¿å­˜çµæœä¿¡è™Ÿå®šç¾©
    save_result = pyqtSignal(str, str)  # content, file_type
    
    def __init__(self):
        self.current_result = ""
        self.current_file_type = "csv"
        # ... UI åˆå§‹åŒ–
    
    def display_result(self, output, error=None):
        # æ™ºèƒ½æª”æ¡ˆé¡å‹æª¢æ¸¬
        file_type = "csv"
        if "json" in output.lower() or output.strip().startswith(('{', '[')):
            file_type = "json"
        elif output.strip().startswith(('<html', '<!DOCTYPE')):
            file_type = "html"
        elif "statistics" in output.lower() or "Type of data:" in output:
            file_type = "txt"
        
        # è¨­ç½®å¯ä¿å­˜å…§å®¹ä¸¦å•Ÿç”¨ä¿å­˜æŒ‰éˆ•
        if output:
            self.set_result_for_saving(output, file_type)
        # ... çµæœé¡¯ç¤ºé‚è¼¯
    
    def save_current_result(self):
        """ä¿å­˜ç•¶å‰çµæœ"""
        if not self.current_result:
            QMessageBox.warning(self, "è­¦å‘Š", "æ²’æœ‰å¯ä¿å­˜çš„çµæœã€‚")
            return
        
        self.save_result.emit(self.current_result, self.current_file_type)
```

**æ§åˆ¶å™¨å±¤å”èª¿**ï¼š
å¯¦ç¾ä½ç½®ï¼š`tools/csvkit/csvkit_controller.py:191-221`

```python
def handle_save_result(self, content, file_type):
    """è™•ç†ä¿å­˜çµæœè«‹æ±‚"""
    try:
        from PyQt5.QtWidgets import QMessageBox
        
        logger.info(f"Saving result to {file_type} file")
        success, message = self.model.save_result_to_file(content, file_type=file_type)
        
        if success:
            QMessageBox.information(
                self.view, 
                "ä¿å­˜æˆåŠŸ", 
                f"æª”æ¡ˆå·²æˆåŠŸä¿å­˜åˆ°:\n{message}"
            )
        else:
            QMessageBox.warning(
                self.view,
                "ä¿å­˜å¤±æ•—", 
                f"æª”æ¡ˆä¿å­˜å¤±æ•—:\n{message}"
            )
    except Exception as e:
        # å®Œæ•´éŒ¯èª¤è™•ç†
        # ...
```

## ğŸ“Š æŠ€è¡“å¯¦ç¾äº®é»

### æ™ºèƒ½ç·¨ç¢¼ç­–ç•¥
1. **åŸ·è¡Œå‘½ä»¤æ™‚**ï¼šUTF-8 â†’ CP950 â†’ BIG5 â†’ GBK â†’ Latin-1 â†’ Bytesæ¨¡å¼
2. **ä¿å­˜æª”æ¡ˆæ™‚**ï¼šUTF-8-BOM â†’ UTF-8 â†’ CP950 â†’ BIG5 â†’ éŒ¯èª¤æ›¿æ›æ¨¡å¼
3. **è·¨å¹³å°ç›¸å®¹æ€§**ï¼šWindows CP950 å’Œ Linux UTF-8 ç’°å¢ƒé›™é‡æ”¯æ´

### ç”¨æˆ¶é«”é©—å„ªåŒ–
- ğŸ¨ **å³æ™‚æŒ‰éˆ•ç‹€æ…‹** - æœ‰çµæœæ™‚å•Ÿç”¨ä¿å­˜æŒ‰éˆ•ï¼Œç„¡çµæœæ™‚ç¦ç”¨
- ğŸ’¾ **æ™ºèƒ½æª”æ¡ˆå‘½å** - åŸºæ–¼æ™‚é–“æˆ³è¨˜å’Œå…§å®¹é¡å‹è‡ªå‹•å»ºè­°æª”å
- ğŸ“‹ **æª”æ¡ˆé¡å‹è­˜åˆ¥** - JSONã€HTMLã€CSVã€çµ±è¨ˆå ±å‘Šè‡ªå‹•åˆ†é¡
- âš ï¸ **å‹å–„éŒ¯èª¤æç¤º** - ä¸­æ–‡åŒ–éŒ¯èª¤è¨Šæ¯å’Œæ“ä½œæŒ‡å¼•

### å¥å£¯éŒ¯èª¤è™•ç†
- ğŸ”„ **å¤šå±¤å›é€€æ©Ÿåˆ¶** - ç·¨ç¢¼ã€ä¿å­˜ã€æª”æ¡ˆæ“ä½œå¤šé‡ä¿è­·
- ğŸ“ **è©³ç´°æ—¥èªŒè¨˜éŒ„** - æ–¹ä¾¿å•é¡Œè¨ºæ–·å’Œæ€§èƒ½å„ªåŒ–
- ğŸ›¡ï¸ **ç•°å¸¸æ•ç²** - å…¨é¢çš„ try-catch ä¿è­·æ‰€æœ‰é—œéµæ“ä½œ
- ğŸ’¬ **ç”¨æˆ¶å‹å–„åé¥‹** - æˆåŠŸ/å¤±æ•—ç‹€æ…‹æ˜ç¢ºé¡¯ç¤º

## ğŸ§ª æ¸¬è©¦é©—è­‰çµæœ

**æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦** - `test_core_features.py`ï¼š
```
========================================
Test Results Summary:
  Model Import: PASS        âœ…
  Encoding Logic: PASS      âœ…  
  Save Logic: PASS          âœ…
  View Integration: PASS    âœ…
  File Operations: PASS     âœ…

Overall: 5/5 tests passed  ğŸ‰
```

**æ¸¬è©¦æ¶µè“‹ç¯„åœ**ï¼š
- âœ… æ¨¡å‹é¡å°å…¥å’ŒåŸºæœ¬æ–¹æ³•å­˜åœ¨æ€§
- âœ… å¤šç·¨ç¢¼æ”¯æ´é‚è¼¯é©—è­‰
- âœ… æª”æ¡ˆä¿å­˜åŠŸèƒ½å®Œæ•´æ€§
- âœ… GUI å…ƒä»¶æ•´åˆæ­£ç¢ºæ€§  
- âœ… æª”æ¡ˆæ“ä½œåŸºæœ¬åŠŸèƒ½

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å•Ÿå‹•æ‡‰ç”¨ç¨‹åº
```bash
cd /path/to/cli_tool
python main_app.py
```

### 2. ä½¿ç”¨ csvkit åŠŸèƒ½
1. é»æ“Šå·¦å´å°èˆªã€ŒğŸ“Š Csvkitã€
2. æ ¹æ“šéœ€è¦é¸æ“‡åŠŸèƒ½æ¨™ç±¤ï¼ˆInput Toolsã€Processingã€Output/Analysisï¼‰
3. å¡«å¯«åƒæ•¸å¾ŒåŸ·è¡Œå‘½ä»¤
4. æŸ¥çœ‹çµæœå€åŸŸçš„è¼¸å‡º
5. é»æ“Šã€ŒğŸ’¾ ä¿å­˜çµæœã€æŒ‰éˆ•ä¿å­˜æª”æ¡ˆ

### 3. ç·¨ç¢¼è™•ç†è‡ªå‹•é‹ä½œ
- åŸ·è¡Œ csvkit å‘½ä»¤æ™‚è‡ªå‹•å˜—è©¦æœ€é©åˆçš„ç·¨ç¢¼
- ä¿å­˜æª”æ¡ˆæ™‚æ™ºèƒ½é¸æ“‡ç›¸å®¹ç·¨ç¢¼
- ä¸­æ–‡å­—ç¬¦å®Œæ•´ä¿ç•™ï¼Œç„¡éœ€æ‰‹å‹•è¨­å®š

## ğŸ“ˆ æ€§èƒ½ç‰¹æ€§

### ç·¨ç¢¼è™•ç†æ•ˆç‡
- **å¿«é€Ÿæª¢æ¸¬** - ç·¨ç¢¼æª¢æ¸¬é€šå¸¸åœ¨ç¬¬1-2æ¬¡å˜—è©¦æˆåŠŸ
- **è¨˜æ†¶é«”å„ªåŒ–** - é¿å…é‡è¤‡è½‰æ›ï¼Œç›´æ¥è™•ç†å­—ç¬¦æµ
- **è¶…æ™‚ä¿è­·** - 30ç§’è¶…æ™‚é˜²æ­¢å‘½ä»¤æ›èµ·

### æª”æ¡ˆä¿å­˜æ•ˆç‡  
- **å³æ™‚æª¢æ¸¬** - çµæœè¼¸å‡ºæ™‚ç«‹å³æª¢æ¸¬æª”æ¡ˆé¡å‹
- **æŒ‰éœ€å•Ÿç”¨** - åƒ…åœ¨æœ‰æœ‰æ•ˆçµæœæ™‚å•Ÿç”¨ä¿å­˜åŠŸèƒ½
- **éŒ¯èª¤å¿«é€Ÿå›é€€** - ç·¨ç¢¼å¤±æ•—æ™‚å¿«é€Ÿåˆ‡æ›åˆ°ä¸‹ä¸€é¸é …

## ğŸ”® æœªä¾†æ“´å±•å¯èƒ½

### åŠŸèƒ½æ“´å±•
1. **æ‰¹æ¬¡æª”æ¡ˆè™•ç†** - æ”¯æ´å¤šæª”æ¡ˆåŒæ™‚ä¿å­˜
2. **è‡ªå®šç¾©ç·¨ç¢¼** - å…è¨±ç”¨æˆ¶æŒ‡å®šç‰¹å®šç·¨ç¢¼æ ¼å¼
3. **æª”æ¡ˆæ ¼å¼æ“´å±•** - æ”¯æ´æ›´å¤šè¼¸å‡ºæ ¼å¼ï¼ˆExcelã€PDFï¼‰
4. **ç¯„æœ¬ç³»çµ±** - é è¨­æª”æ¡ˆä¿å­˜ä½ç½®å’Œå‘½åè¦å‰‡

### æŠ€è¡“å„ªåŒ–
1. **ç·¨ç¢¼æ™ºèƒ½å­¸ç¿’** - è¨˜éŒ„æˆåŠŸç·¨ç¢¼ï¼Œå„ªåŒ–æª¢æ¸¬é †åº
2. **æª”æ¡ˆå£“ç¸®** - å¤§æª”æ¡ˆè‡ªå‹•å£“ç¸®ä¿å­˜
3. **é›²ç«¯æ•´åˆ** - æ”¯æ´é›²ç«¯å„²å­˜æœå‹™
4. **é€²åº¦é¡¯ç¤º** - å¤§æª”æ¡ˆä¿å­˜é€²åº¦æ¢

## ğŸ“‹ æª”æ¡ˆæ¸…å–®

### æ–°å¢æª”æ¡ˆ
- `encoding_save_implementation.md` - æœ¬å¯¦ç¾ç¸½çµ
- `test_core_features.py` - æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦
- `test_encoding_save_simple.py` - ç°¡åŒ–ç·¨ç¢¼æ¸¬è©¦
- `test_encoding_and_save.py` - åŸå§‹å®Œæ•´æ¸¬è©¦

### ä¿®æ”¹æª”æ¡ˆ
- `tools/csvkit/csvkit_model.py` - æ·»åŠ å¤šç·¨ç¢¼è™•ç†å’Œä¿å­˜åŠŸèƒ½
- `tools/csvkit/csvkit_view.py` - æ·»åŠ ä¿å­˜æŒ‰éˆ•å’Œæª”æ¡ˆé¡å‹æª¢æ¸¬
- `tools/csvkit/csvkit_controller.py` - æ·»åŠ ä¿å­˜è™•ç†é‚è¼¯

## ğŸ“Š ç¸½çµ

âœ… **åœ“æ»¿å®Œæˆæ‰€æœ‰è¦æ±‚**ï¼š
1. âœ… è§£æ±º UTF-8 å’Œ CP950 ç­‰ç·¨ç¢¼è™•ç†å•é¡Œ
2. âœ… å¯¦ç¾è™•ç†å¾Œå…§å®¹ç”Ÿæˆå¯¦éš›æª”æ¡ˆä¸¦å­˜å„²æ–¼æœ¬åœ°
3. âœ… æä¾›ç”¨æˆ¶å‹å–„çš„æª”æ¡ˆå°è©±æ¡†æ“ä½œ
4. âœ… æ”¯æ´å¤šç¨®æª”æ¡ˆæ ¼å¼è‡ªå‹•è­˜åˆ¥
5. âœ… å»ºç«‹å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œå›é€€æ©Ÿåˆ¶

**æŠ€è¡“åƒ¹å€¼**ï¼š
- ğŸ—ï¸ **å¼·å¥çš„æ¶æ§‹** - å¤šå±¤æ¬¡ç·¨ç¢¼è™•ç†å’ŒéŒ¯èª¤æ¢å¾©
- ğŸŒ **åœ‹éš›åŒ–æ”¯æ´** - å®Œæ•´çš„ä¸­æ–‡å­—ç¬¦è™•ç†èƒ½åŠ›  
- ğŸ¯ **ç”¨æˆ¶é«”é©—** - ç›´è§€çš„æ“ä½œæµç¨‹å’Œå‹å–„çš„åé¥‹æ©Ÿåˆ¶
- ğŸ”§ **å¯ç¶­è­·æ€§** - æ¸…æ™°çš„ä»£ç¢¼çµæ§‹å’Œå®Œæ•´çš„æ¸¬è©¦è¦†è“‹

csvkit æ’ä»¶ç¾åœ¨æä¾›å®Œæ•´çš„ç·¨ç¢¼è™•ç†å’Œæª”æ¡ˆä¿å­˜åŠŸèƒ½ï¼Œç¢ºä¿ç”¨æˆ¶å¯ä»¥ç„¡ç¸«è™•ç†åŒ…å«ä¸­æ–‡å­—ç¬¦çš„æ•¸æ“šï¼Œä¸¦å°‡çµæœå®‰å…¨ä¿å­˜åˆ°æœ¬åœ°æª”æ¡ˆç³»çµ±ã€‚

---

**å¯¦ç¾å®Œæˆæ™‚é–“**ï¼š2025-08-13  
**ç‰ˆæœ¬**ï¼š2.0.0  
**ç‹€æ…‹**ï¼šâœ… å®Œæˆä¸¦é€šéæ‰€æœ‰æ¸¬è©¦